!function(){"use strict";function a(a){return document.getElementById(a)}function b(a){this.width=0,this.height=0,this.isEnabled=!1,this.el=a,this.init()}function c(){this.init()}b.prototype.init=function(){this.audioCtx=new(window.AudioContext||window.webkitAudioContext),this.analyser=this.audioCtx.createAnalyser(),this.analyser.smoothingTimeConstant=.7,this.analyser.fftSize=1024,this.fdata=new Uint8Array(this.analyser.frequencyBinCount),this.fitCanvas(),this.ctx=this.el.getContext("2d"),this.render()},b.prototype.start=function(){this.isEnabled=!0},b.prototype.stop=function(){this.isEnabled=!1,this.clear()},b.prototype.changeSource=function(a){var b=this.audioCtx.createMediaElementSource(a);b.connect(this.analyser),this.analyser.connect(this.audioCtx.destination)},b.prototype.render=function(){if(requestAnimationFrame(this.render.bind(this)),this.isEnabled){this.analyser.getByteFrequencyData(this.fdata),this.clear(),this.ctx.lineWidth=2,this.ctx.strokeStyle="rgb(128, 128, 128)",this.ctx.beginPath();for(var a=1*this.width/this.fdata.length,b=0,c=0;c<this.fdata.length;c++){var d=this.fdata[c]/256,e=d*this.height;0===c?this.ctx.moveTo(b,e):this.ctx.lineTo(b,e),b+=a}this.ctx.lineTo(this.width,this.height/2),this.ctx.stroke()}},b.prototype.fitCanvas=function(){var a=window.devicePixelRatio||1;this.width=this.el.parentNode.clientWidth*a,this.height=this.el.parentNode.clientHeight*a,this.el.width=this.width,this.el.height=this.height},b.prototype.clear=function(){this.ctx.clearRect(0,0,this.width,this.height)},c.prototype.init=function(){this.el={audio:a("audio"),file:a("file"),play:a("play"),icoPlay:a("icoplay"),icoStop:a("icostop"),visualize:a("visualize"),canvas:a("canvas"),dropzone:a("dropzone"),title:a("title")},this.visualizer=new b(this.el.canvas),this.visualizer.changeSource(this.el.audio),this.addHandlers()},c.prototype.addHandlers=function(){var a=this;this.el.file.addEventListener("change",function(){a.open(this.files[0])}),this.el.play.addEventListener("click",function(){a.togglePlayStop()}),this.el.audio.addEventListener("error",function(){a.error("Some error occured")}),this.el.audio.addEventListener("ended",function(){a.stop()}),this.el.dropzone.addEventListener("dragover",function(a){this.classList.add("b-dropzone_visible"),a.preventDefault()}),this.el.dropzone.addEventListener("dragleave",function(a){this.classList.remove("b-dropzone_visible"),a.preventDefault()}),this.el.dropzone.addEventListener("dragend",function(a){a.preventDefault()}),this.el.dropzone.addEventListener("drop",function(b){b.preventDefault(),a.open(b.dataTransfer.files[0])}),this.el.visualize.addEventListener("click",function(){a.toggleVisualization()})},c.prototype.open=function(a){this.el.audio.canPlayType(a.type)?(this.setTitle(a),this.el.audio.src=URL.createObjectURL(a),this.play(),this.visualizer.isEnabled&&this.visualizer.start()):this.error("Can't play this file")},c.prototype.play=function(){this.el.icoPlay.style.display="none",this.el.icoStop.style.display="inline",this.el.audio.play()},c.prototype.stop=function(){this.el.icoPlay.style.display="inline",this.el.icoStop.style.display="none",this.el.audio.pause()},c.prototype.togglePlayStop=function(){this.el.audio.paused?this.play():this.stop()},c.prototype.setTitle=function(a){this.el.dropzone.classList.remove("b-dropzone_visible");var b=this;id3(a,function(c,d){b.el.title.innerHTML=!c&&/\w+/.test(d.title)&&/\w+/.test(d.title)?d.title+" â€” "+d.artist:a.name})},c.prototype.startVisualize=function(){this.el.visualize.classList.remove("b-controls__item_muted"),this.visualizer.start()},c.prototype.stopVisualize=function(){this.el.visualize.classList.add("b-controls__item_muted"),this.visualizer.stop()},c.prototype.toggleVisualization=function(){this.visualizer.isEnabled?this.stopVisualize():this.startVisualize()},c.prototype.error=function(a){alert(a)},c.prototype.visualize=function(){function a(){requestAnimationFrame(a),analyser.getByteFrequencyData(b),console.log(b)}var b=new Uint8Array(analyser.frequencyBinCount);a()},new c}();