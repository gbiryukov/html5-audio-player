!function(){var a=function(b){this.type=b||a.OPEN_URI,this.size=null,this.file=null};if(a.OPEN_FILE=1,a.OPEN_URI=2,a.OPEN_LOCAL=3,"function"==typeof require)var b=require("fs");a.prototype.open=function(c,d){this.file=c;var e=this;switch(this.type){case a.OPEN_LOCAL:b.stat(this.file,function(a,c){return a?d(a):(e.size=c.size,void b.open(e.file,"r",function(a,b){return a?d(a):(e.fd=b,void d())}))});break;case a.OPEN_FILE:this.size=this.file.size,d();break;default:this.ajax({uri:this.file,type:"HEAD"},function(a,b,c){return a?d(a):(e.size=parseInt(c.getResponseHeader("Content-Length")),void d())})}},a.prototype.close=function(){this.type===a.OPEN_LOCAL&&b.close(this.fd)},a.prototype.read=function(b,c,d){"function"==typeof c&&(d=c,c=0),this.type===a.OPEN_LOCAL?this.readLocal(b,c,d):this.type===a.OPEN_FILE?this.readFile(b,c,d):this.readUri(b,c,d)},a.prototype.readBlob=function(a,b,c,d){"function"==typeof b?(d=b,b=0):"function"==typeof c&&(d=c,c="application/octet-stream"),this.read(a,b,function(a,b){return a?void d(a):void d(null,new Blob([b],{type:c}))})},a.prototype.readLocal=function(a,c,d){var e=new Buffer(a);b.read(this.fd,e,0,a,c,function(a,b,c){if(a)return d(a);for(var e=new ArrayBuffer(c.length),f=new Uint8Array(e),g=0;g<c.length;g++)f[g]=c[g];d(null,e)})},a.prototype.ajax=function(a,b){var c={type:"GET",uri:null,responseType:"text"};"string"==typeof a&&(a={uri:a});for(var d in a)c[d]=a[d];var e=new XMLHttpRequest;e.onreadystatechange=function(){return 4===e.readyState?200!==e.status&&206!==e.status?b("Received non-200/206 response ("+e.status+")"):void b(null,e.response,e):void 0},e.responseType=c.responseType,e.open(c.type,c.uri,!0),c.range&&(c.range=[].concat(c.range),2===c.range.length?e.setRequestHeader("Range","bytes="+c.range[0]+"-"+c.range[1]):e.setRequestHeader("Range","bytes="+c.range[0])),e.send()},a.prototype.readUri=function(a,b,c){this.ajax({uri:this.file,type:"GET",responseType:"arraybuffer",range:[b,b+a-1]},function(a,b){return a?c(a):c(null,b)})},a.prototype.readFile=function(a,b,c){var d=this.file.slice(b,b+a),e=new FileReader;e.onload=function(a){c(null,a.target.result)},e.onerror=function(){c("File read failed")},e.readAsArrayBuffer(d)},DataView.prototype.getString=function(a,b,c){b=b||0,a=a||this.byteLength-b,0>a&&(a+=this.byteLength);var d="",e="";if("undefined"!=typeof Buffer){for(var f=[],g=b;b+a>g;g++)f.push(this.getUint8(g));return new Buffer(f).toString()}for(var g=b;b+a>g;g++)d+=String.fromCharCode(this.getUint8(g));if(c)return d;try{e=decodeURIComponent(escape(d))}catch(h){}return e},DataView.prototype.getStringUtf16=function(a,b,c){b=b||0,a=a||this.byteLength-b;var d=!1,e="",f=!1;if("undefined"!=typeof Buffer&&(e=[],f=!0),0>a&&(a+=this.byteLength),c){var g=this.getUint16(b);65534===g&&(d=!0),b+=2,a-=2}for(var h=b;b+a>h;h+=2){var i=this.getUint16(h,d);i>=0&&55295>=i||i>=57344&&65535>=i?f?e.push(i):e+=String.fromCharCode(i):i>=65536&&1114111>=i&&(i-=65536,f?(e.push(((1047552&i)>>10)+55296),e.push((1023&i)+56320)):e+=String.fromCharCode(((1047552&i)>>10)+55296)+String.fromCharCode((1023&i)+56320))}return f?new Buffer(e).toString():decodeURIComponent(escape(e))},DataView.prototype.getSynch=function(a){for(var b=0,c=2130706432;c;)b>>=1,b|=a&c,c>>=8;return b},DataView.prototype.getUint8Synch=function(a){return this.getSynch(this.getUint8(a))},DataView.prototype.getUint32Synch=function(a){return this.getSynch(this.getUint32(a))},DataView.prototype.getUint24=function(a,b){return b?this.getUint8(a)+(this.getUint8(a+1)<<8)+(this.getUint8(a+2)<<16):this.getUint8(a+2)+(this.getUint8(a+1)<<8)+(this.getUint8(a)<<16)};var c=function(b,d){var e={type:c.OPEN_URI};"string"==typeof b?b={file:b,type:c.OPEN_URI}:"undefined"!=typeof window&&window.File&&b instanceof window.File&&(b={file:b,type:c.OPEN_FILE});for(var f in b)e[f]=b[f];if(!e.file)return d("No file was set");if(e.type===c.OPEN_FILE){if("undefined"==typeof window||!window.File||!window.FileReader||"undefined"==typeof ArrayBuffer)return d("Browser does not have support for the File API and/or ArrayBuffers")}else if(e.type===c.OPEN_LOCAL&&"function"!=typeof require)return d("Local paths may not be read within a browser");var g=["Blues","Classic Rock","Country","Dance","Disco","Funk","Grunge","Hip-Hop","Jazz","Metal","New Age","Oldies","Other","Pop","R&B","Rap","Reggae","Rock","Techno","Industrial","Alternative","Ska","Death Metal","Pranks","Soundtrack","Euro-Techno","Ambient","Trip-Hop","Vocal","Jazz+Funk","Fusion","Trance","Classical","Instrumental","Acid","House","Game","Sound Clip","Gospel","Noise","AlternRock","Bass","Soul","Punk","Space","Meditative","Instrumental Pop","Instrumental Rock","Ethnic","Gothic","Darkwave","Techno-Industrial","Electronic","Pop-Folk","Eurodance","Dream","Southern Rock","Comedy","Cult","Gangsta Rap","Top 40","Christian Rap","Pop / Funk","Jungle","Native American","Cabaret","New Wave","Psychedelic","Rave","Showtunes","Trailer","Lo-Fi","Tribal","Acid Punk","Acid Jazz","Polka","Retro","Musical","Rock & Roll","Hard Rock","Folk","Folk-Rock","National Folk","Swing","Fast  Fusion","Bebob","Latin","Revival","Celtic","Bluegrass","Avantgarde","Gothic Rock","Progressive Rock","Psychedelic Rock","Symphonic Rock","Slow Rock","Big Band","Chorus","Easy Listening","Acoustic","Humour","Speech","Chanson","Opera","Chamber Music","Sonata","Symphony","Booty Bass","Primus","Porn Groove","Satire","Slow Jam","Club","Tango","Samba","Folklore","Ballad","Power Ballad","Rhythmic Soul","Freestyle","Duet","Punk Rock","Drum Solo","A Cappella","Euro-House","Dance Hall","Goa","Drum & Bass","Club-House","Hardcore","Terror","Indie","BritPop","Negerpunk","Polsk Punk","Beat","Christian Gangsta Rap","Heavy Metal","Black Metal","Crossover","Contemporary Christian","Christian Rock","Merengue","Salsa","Thrash Metal","Anime","JPop","Synthpop","Rock/Pop"],h={};h.types={TALB:"album",TBPM:"bpm",TCOM:"composer",TCON:"genre",TCOP:"copyright",TDEN:"encoding-time",TDLY:"playlist-delay",TDOR:"original-release-time",TDRC:"recording-time",TDRL:"release-time",TDTG:"tagging-time",TENC:"encoder",TEXT:"writer",TFLT:"file-type",TIPL:"involved-people",TIT1:"content-group",TIT2:"title",TIT3:"subtitle",TKEY:"initial-key",TLAN:"language",TLEN:"length",TMCL:"credits",TMED:"media-type",TMOO:"mood",TOAL:"original-album",TOFN:"original-filename",TOLY:"original-writer",TOPE:"original-artist",TOWN:"owner",TPE1:"artist",TPE2:"band",TPE3:"conductor",TPE4:"remixer",TPOS:"set-part",TPRO:"produced-notice",TPUB:"publisher",TRCK:"track",TRSN:"radio-name",TRSO:"radio-owner",TSOA:"album-sort",TSOP:"performer-sort",TSOT:"title-sort",TSRC:"isrc",TSSE:"encoder-settings",TSST:"set-subtitle",TAL:"album",TBP:"bpm",TCM:"composer",TCO:"genre",TCR:"copyright",TDY:"playlist-delay",TEN:"encoder",TFT:"file-type",TKE:"initial-key",TLA:"language",TLE:"length",TMT:"media-type",TOA:"original-artist",TOF:"original-filename",TOL:"original-writer",TOT:"original-album",TP1:"artist",TP2:"band",TP3:"conductor",TP4:"remixer",TPA:"set-part",TPB:"publisher",TRC:"isrc",TRK:"track",TSS:"encoder-settings",TT1:"content-group",TT2:"title",TT3:"subtitle",TXT:"writer",WCOM:"url-commercial",WCOP:"url-legal",WOAF:"url-file",WOAR:"url-artist",WOAS:"url-source",WORS:"url-radio",WPAY:"url-payment",WPUB:"url-publisher",WAF:"url-file",WAR:"url-artist",WAS:"url-source",WCM:"url-commercial",WCP:"url-copyright",WPB:"url-publisher",COMM:"comments",APIC:"image",PIC:"image"},h.imageTypes=["other","file-icon","icon","cover-front","cover-back","leaflet","media","artist-lead","artist","conductor","band","composer","writer","location","during-recording","during-performance","screen","fish","illustration","logo-band","logo-publisher"],h.parse=function(a,b,c){c=c||0,b=b||4;var d={tag:null,value:null},e=new DataView(a);if(3>b)return h.parseLegacy(a);var f={id:e.getString(4),type:e.getString(1),size:e.getUint32Synch(4),flags:[e.getUint8(8),e.getUint8(9)]};if(0!==f.flags[1])return!1;if(!f.id in h.types)return!1;if(d.tag=h.types[f.id],"T"===f.type){var i=e.getUint8(10);if(0===i||3===i)d.value=e.getString(-11,11);else if(1===i)d.value=e.getStringUtf16(-11,11,!0);else{if(2!==i)return!1;d.value=e.getStringUtf16(-11,11)}"TCON"===f.id&&parseInt(d.value)&&(d.value=g[parseInt(d.value)])}else if("W"===f.type)d.value=e.getString(-10,10);else if("COMM"===f.id){for(var i=e.getUint8(10),j=14,k=0,l=j;;l++)if(1===i||2===i){if(0===e.getUint16(l)){j=l+2;break}l++}else if(0===e.getUint8(l)){j=l+1;break}if(0===i||3===i)d.value=e.getString(-1*j,j);else if(1===i)d.value=e.getStringUtf16(-1*j,j,!0);else{if(2!==i)return!1;d.value=e.getStringUtf16(-1*j,j)}}else if("APIC"===f.id){for(var i=e.getUint8(10),m={type:null,mime:null,description:null,data:null},j=11,k=0,l=j;;l++)if(0===e.getUint8(l)){k=l-j;break}m.mime=e.getString(k,j),m.type=h.imageTypes[e.getUint8(j+k+1)]||"other",j+=k+2,k=0;for(var l=j;;l++)if(0===e.getUint8(l)){k=l-j;break}m.description=0===k?null:e.getString(k,j),m.data=a.slice(j+1),d.value=m}return d.tag?d:!1},h.parseLegacy=function(a){var b={tag:null,value:null},c=new DataView(a),d={id:c.getString(3),type:c.getString(1),size:c.getUint24(3)};if(!d.id in h.types)return!1;if(b.tag=h.types[d.id],"T"===d.type){{c.getUint8(7)}b.value=c.getString(-7,7),"TCO"===d.id&&parseInt(b.value)&&(b.value=g[parseInt(b.value)])}else if("W"===d.type)b.value=c.getString(-7,7);else if("COM"===d.id){{c.getUint8(6)}b.value=c.getString(-10,10),-1!==b.value.indexOf("\x00")&&(b.value=b.value.substr(b.value.indexOf("\x00")+1))}else if("PIC"===d.id){var e=(c.getUint8(6),{type:null,mime:"image/"+c.getString(3,7).toLowerCase(),description:null,data:null});e.type=h.imageTypes[c.getUint8(11)]||"other";for(var f=11,i=0,j=f;;j++)if(0===c.getUint8(j)){i=j-f;break}e.description=0===i?null:c.getString(i,f),e.data=a.slice(f+1),b.value=e}return b.tag?b:!1};var i={};i.parse=function(a,b){var c={title:null,album:null,artist:null,year:null,v1:{title:null,artist:null,album:null,year:null,comment:null,track:null,version:1},v2:{version:[null,null]}},d={v1:!1,v2:!1},e=function(a){d.v1&&d.v2&&(c.title=c.v2.title||c.v1.title,c.album=c.v2.album||c.v1.album,c.artist=c.v2.artist||c.v1.artist,c.year=c.v1.year,b(a,c))};a.read(128,a.size-128,function(a,b){if(a)return e("Could not read file");var f=new DataView(b);return 128!==b.byteLength||"TAG"!==f.getString(3,null,!0)?(d.v1=!0,e()):(c.v1.title=f.getString(30,3).replace(/(^\s+|\s+$)/,"")||null,c.v1.artist=f.getString(30,33).replace(/(^\s+|\s+$)/,"")||null,c.v1.album=f.getString(30,63).replace(/(^\s+|\s+$)/,"")||null,c.v1.year=f.getString(4,93).replace(/(^\s+|\s+$)/,"")||null,0===f.getUint8(125)?(c.v1.comment=f.getString(28,97).replace(/(^\s+|\s+$)/,""),c.v1.version=1.1,c.v1.track=f.getUint8(126)):c.v1.comment=f.getString(30,97).replace(/(^\s+|\s+$)/,""),c.v1.genre=g[f.getUint8(127)]||null,d.v1=!0,void e())}),a.read(14,0,function(b,f){if(b)return e("Could not read file");var g,i=new DataView(f),j=10,k=0;return 14!==f.byteLength||"ID3"!==i.getString(3,null,!0)||i.getUint8(3)>4?(d.v2=!0,e()):(c.v2.version=[i.getUint8(3),i.getUint8(4)],g=i.getUint8(5),0!==(128&g)?(d.v2=!0,e()):(0!==(64&g)&&(j+=i.getUint32Synch(11)),k+=i.getUint32Synch(6),void a.read(k,j,function(a,b){if(a)return d.v2=!0,e();for(var f=new DataView(b),g=0;g<b.byteLength;){for(var i,j,k,l=!0,m=0;3>m;m++)k=f.getUint8(g+m),(65>k||k>90)&&(48>k||k>57)&&(l=!1);if(!l)break;j=c.v2.version[0]<3?b.slice(g,g+6+f.getUint24(g+3)):b.slice(g,g+10+f.getUint32Synch(g+4)),i=h.parse(j,c.v2.version[0]),i&&(c.v2[i.tag]=i.value),g+=j.byteLength}d.v2=!0,e()})))})};var j=new a(e.type);j.open(e.file,function(a){return a?d("Could not open specified file"):void i.parse(j,function(a,b){d(a,b),j.close()})})};c.OPEN_FILE=a.OPEN_FILE,c.OPEN_URI=a.OPEN_URI,c.OPEN_LOCAL=a.OPEN_LOCAL,"undefined"!=typeof module&&module.exports?module.exports=c:"function"==typeof define&&define.amd?define("id3",[],function(){return c}):window.id3=c}();